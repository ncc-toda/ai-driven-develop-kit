# 設計書に基づく実装ワークフロー

設計書に基づいて TDD（Red-Green-Refactor）で実装を行うワークフローです。

## 使い方

````bash
/wf-design-impl 実装対象と参照する設計書
```bash

---

## STEP 1: 作業ログ作成

`docs/tasks/ai-logs/YYYY-MM-DD_{slug}.md` に作業ログを作成すること。

## STEP 2: 設計書の確認

以下の設計書を確認すること:

- 実装対象の設計書（API 設計、DB 設計、画面設計等）
- 関連する要件定義
- 初期設計（アーキテクチャ、ディレクトリ構造）

不明点がある場合はユーザーに確認すること。

## STEP 3: 実装範囲の特定

以下を明確にすること:

- 今回実装する範囲
- 依存する他の機能・コンポーネント
- 実装の順序（依存関係を考慮）

## STEP 4: テスト作成 (Red)

設計書に基づき、期待される振る舞いをテストで記述すること。
この時点でテストは失敗する状態であること。

テストが書けない場合は、動作確認項目を定義すること。

## STEP 5: 実装 (Green)

設計書に従い、テストをパスさせる最小限のコードを実装すること。
問題が発生した場合は作業ログに記録すること。

## STEP 6: 検証 (1回目)

以下を順番に実行すること。

### 1. 静的解析

```bash
devbox run lint
```bash

エラーが出た場合は修正すること。

### 2. フォーマット確認

```bash
devbox run format
```bash

変更があった場合はコミットに含めること。

### 3. テスト実行

```bash
# TypeScript
devbox run test:ts

# Dart
devbox run test:dart
```bash

失敗した場合は修正すること。

### 4. 動作確認

- AI で確認可能な場合: 動作確認を実施する
- AI で確認不可能な場合: ユーザーに確認を依頼する

## STEP 7: リファクタリング

「動く」だけでなく「保守できる」状態にすること:

- 設計書に沿った構造になっているか
- DRY 原則の適用
- 適切な命名

## STEP 8: 検証 (2回目)

STEP 6 と同様に静的解析・テストを再度実行すること。

## STEP 9: セルフレビュー

作業内容に応じて適切な役割を選択し、その観点でレビューを行うこと。
問題があれば修正し、STEP 8 に戻ること。

追加で以下も確認:

- 設計書どおりに実装されているか
- 設計から逸脱している箇所はないか（ある場合は理由を記録）

**共通の観点:**

- **セキュリティ**: 認証・認可の漏れ、バリデーション不足、機密情報の露出、OWASP Top 10
- **品質・設計**: エッジケース、命名、パフォーマンス、エラーハンドリング、可読性・保守性
- **テスト**: テストケースの十分さ（正常系・異常系・境界値）、テストの意図
- **ミニマリスト**: 余計な変更、不要な抽象化、YAGNI 原則

## STEP 10: 完了

1. 作業ログの「振り返り」セクションを記入すること
2. 必要に応じてドキュメント・ルールを更新すること
3. Git コミットすること
4. ユーザーに完了報告すること
````
