# 機能追加ワークフロー

TDD（Red-Green-Refactor）で機能追加を行うワークフローです。

## 使い方

````bash
/wf-feature 追加したい機能の説明
```bash

---

## STEP 1: 作業ログ作成

`docs/tasks/ai-logs/YYYY-MM-DD_{slug}.md` に作業ログを作成すること。

**テンプレート:**

```markdown
# {タイトル}

## 概要

{作業内容の説明}

## 作業内容

{実施した内容を記録}

## 検証結果

{テストや動作確認の結果}

---

## 発生した問題・はまったこと

### 問題1: {問題の概要}

**現象**:
**原因**:
**解決策**:
**今後の注意点**:

## 振り返り

### 学んだこと

-

### ドキュメント・ルール更新の提案

| 対象ファイル | 更新内容 |
| ------------ | -------- |
|              |          |
```bash

## STEP 2: インターフェース設計 (SDD)

以下を確認・設計すること:

- 既存のスキーマ（DB, API, 型定義）との整合性
- 新機能に必要なデータ構造、関数シグネチャ

必要に応じて型定義ファイルを先に作成すること。

## STEP 3: 完了条件の定義 (TDD)

以下を定義すること:

- 期待される振る舞いをテストコードで記述（Red 状態）
- ユーザーが確認すべき動作（Acceptance Criteria）

**ユーザーの承認を得てから次のステップに進むこと。**

## STEP 4: 実装

定義したスキーマ・型に基づき、最小限のコードで機能を実装すること。
問題が発生した場合は作業ログに記録すること。

## STEP 5: 検証 (1回目)

以下を順番に実行すること。

### 1. 静的解析

```bash
devbox run lint
```bash

エラーが出た場合は修正すること。

### 2. フォーマット確認

```bash
devbox run format
```bash

変更があった場合はコミットに含めること。

### 3. テスト実行

```bash
# TypeScript
devbox run test:ts

# Dart
devbox run test:dart
```bash

失敗した場合は修正すること。

### 4. 動作確認

- AI で確認可能な場合: 動作確認を実施する
- AI で確認不可能な場合: ユーザーに確認を依頼する

## STEP 6: リファクタリング

「動く」だけでなく「保守できる」状態にすること:

- DRY 原則の適用
- 凝集度の向上
- 不要な抽象化の排除

## STEP 7: 検証 (2回目)

STEP 5 と同様に静的解析・テストを再度実行すること。

## STEP 8: セルフレビュー

作業内容に応じて適切な役割を選択し、その観点でレビューを行うこと。
問題があれば修正し、STEP 7 に戻ること。

追加で以下も確認:

- SDD に沿った責務分離ができているか
- 既存構造を壊していないか

**共通の観点:**

- **セキュリティ**: 認証・認可の漏れ、バリデーション不足、機密情報の露出、OWASP Top 10
- **品質・設計**: エッジケース、命名、パフォーマンス、エラーハンドリング、可読性・保守性
- **テスト**: テストケースの十分さ（正常系・異常系・境界値）、テストの意図
- **ミニマリスト**: 余計な変更、不要な抽象化、YAGNI 原則

## STEP 9: 完了

1. 作業ログの「振り返り」セクションを記入すること
2. 必要に応じてドキュメント・ルールを更新すること
3. Git コミットすること
4. ユーザーに完了報告すること
````
