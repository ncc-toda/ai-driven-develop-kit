# 高度な設計思想（原則 23-24）

## 23. オブジェクトベースにする (Object-Based) [P1]

**定義**: ユーザーの関心の対象（オブジェクト）を特定し、それを中心に UI を構築する

**別名**: OOUI（Object-Oriented User Interface）

### タスクベース vs オブジェクトベース

```text
❌ タスクベース（問題あり）:
├ 新規登録
├ 商品検索
├ 商品削除
├ 注文検索
└ 顧客管理

✅ オブジェクトベース（改善）:
├ 商品
│ ├ 一覧・検索
│ ├ 詳細表示
│ └ 編集・削除
├ 注文
│ ├ 一覧・検索
│ └ 詳細表示
└ 顧客
  ├ 一覧・検索
  └ 詳細表示
```

### オブジェクト抽出の手順

1. **ユーザーストーリー収集**: 「〜したい」から名詞を抽出
2. **名詞の抽出**: 商品、注文、顧客、カート...
3. **動詞の抽出**: 登録、検索、編集、削除...
4. **CRUD マッピング**: 動詞を標準操作に対応付け

### 実装パターン

```javascript
// オブジェクト管理の共通クラス
class ObjectManager {
  constructor(objectType) {
    this.objectType = objectType;
    this.operations = {
      list: () => this.fetchObjectList(),
      view: (id) => this.fetchObjectDetail(id),
      create: () => this.showCreateForm(),
      edit: (id) => this.showEditForm(id),
      delete: (id) => this.confirmAndDelete(id),
    };
  }

  // オブジェクト固有の操作を追加
  addCustomOperation(name, handler) {
    this.operations[name] = handler;
  }
}

// 商品オブジェクト
const productManager = new ObjectManager("product");
productManager.addCustomOperation("duplicate", (id) => {
  /* 複製処理 */
});
```

### UI 構造

```html
<!-- オブジェクト一覧（コレクション）-->
<div class="object-collection" data-object-type="book">
  <header>
    <h1>蔵書管理</h1>
    <button class="btn primary">新しい本を登録</button>
  </header>
  <div class="collection-filters">
    <input type="search" placeholder="タイトルや著者で検索..." />
  </div>
  <div class="collection-items" id="book-list"></div>
</div>

<!-- オブジェクト詳細 -->
<div class="object-detail" data-object-id="123">
  <header>
    <button onclick="goBackToList()">← 一覧に戻る</button>
    <div class="detail-actions">
      <button>編集</button>
      <button>複製</button>
      <button class="danger">削除</button>
    </div>
  </header>
  <div class="detail-content">
    <!-- オブジェクトの属性表示 -->
  </div>
</div>
```

### よくある失敗

1. **タスクをそのまま画面にマッピング**: 機能ごとに別画面
2. **オブジェクトが見えない**: 抽象的なメニュー（「管理」「操作」）
3. **操作後にオブジェクトが消える**: 編集後に一覧に強制遷移

---

## 24. ビューはオブジェクトを表象する (Object Representation by Views) [P2]

**定義**: 一つのオブジェクトは複数のビューで表現され、各ビューは特定の目的に最適化されている

### ビューとは

- オブジェクトを表示するための「窓」
- 同じデータを異なる形式・粒度・文脈で提示
- 目的や状況に応じて最適なビューを提供

### ビューの種類

| ビュー            | 特徴                   | 用途               |
| ----------------- | ---------------------- | ------------------ |
| アイコン/グリッド | 視覚的識別、サムネイル | ブラウジング、選択 |
| リスト            | 詳細情報、ソート可能   | 比較、管理         |
| 詳細              | 全情報、編集機能       | 確認、編集         |
| カード            | 要約情報、アクション   | ダッシュボード     |
| テーブル          | 構造化データ、一括操作 | 分析、管理         |

### 実装例

```javascript
class ProductViewManager {
  getOptimalView(purpose, context) {
    const viewConfigs = {
      browsing: {
        type: "card",
        fields: ["name", "price", "mainImage", "rating"],
        layout: "grid",
      },
      comparing: {
        type: "table",
        fields: ["name", "price", "specs", "rating"],
        layout: "row",
      },
      purchasing: {
        type: "detailed",
        fields: ["name", "price", "description", "images", "reviews", "stock"],
        layout: "single",
      },
    };
    return viewConfigs[purpose] || viewConfigs.browsing;
  }
}
```

### ビュー切り替え UI

```html
<div class="view-switcher">
  <button data-view="grid" onclick="switchView('grid')">📋 グリッド</button>
  <button data-view="list" onclick="switchView('list')">📝 リスト</button>
  <button data-view="table" onclick="switchView('table')">📊 テーブル</button>
</div>

<div class="object-view" id="current-view">
  <!-- 選択されたビューで表示 -->
</div>
```

### Model-View 分離

```javascript
class ProductModel {
  constructor(data) {
    this.id = data.id;
    this.name = data.name;
    this.price = data.price;
    // ... 他の属性
  }

  // データ操作（ビューに依存しない）
  updatePrice(newPrice) {
    this.price = newPrice;
    this.notifyViews("priceChanged", newPrice);
  }
}

class ProductView {
  constructor(model, config) {
    this.model = model;
    this.config = config;
  }

  render() {
    switch (this.config.type) {
      case "summary":
        return this.renderSummary();
      case "detailed":
        return this.renderDetailed();
      case "card":
        return this.renderCard();
    }
  }
}
```

### デザインパターン

1. **コレクション + アイテム**: 一覧と詳細の切り替え
2. **マスター・ディテール**: 2 ペインレイアウト
3. **モーダルレス編集**: インライン編集

```html
<!-- マスター・ディテールパターン -->
<div class="master-detail-layout">
  <div class="master-pane">
    <div class="object-list">
      <div class="list-item" onclick="selectItem(1)">商品 A</div>
      <div class="list-item" onclick="selectItem(2)">商品 B</div>
    </div>
  </div>
  <div class="detail-pane">
    <div id="selected-item-detail">
      <!-- 選択されたアイテムの詳細 -->
    </div>
  </div>
</div>
```
