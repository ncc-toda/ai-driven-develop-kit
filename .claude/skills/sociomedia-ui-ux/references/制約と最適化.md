# 制約と最適化（原則 14-17）

## 14. コンストレイント (Constraint) [P1]

**定義**: ユーザーの行動を意図的に制限し、誤操作を減らし正しい使い方を促す

### コンストレイントの種類

1. **物理的**: 形状や構造による制限（USB ポートの向き）
2. **意味的**: 文脈に応じた機能制限（選択なし → コピー無効）
3. **文化的**: 慣習による制限（赤=危険、緑=安全）
4. **論理的**: 依存関係による制限（配送方法選択 → 日付選択可能に）

### UI 実装例

```html
<!-- 数値制限 -->
<input type="number" min="0" max="120" step="1" />

<!-- 電話番号制限 -->
<input type="tel" pattern="[0-9]{3}-[0-9]{4}-[0-9]{4}" maxlength="13" />

<!-- ファイル形式制限 -->
<input type="file" accept=".jpg,.jpeg,.png,.pdf" />
```

### 順序の強制

```html
<div class="wizard-steps">
  <div class="step completed">1. アカウント情報</div>
  <div class="step active">2. プロフィール</div>
  <div class="step disabled">3. 確認</div>
</div>
```

### 注意点

- 制約の理由を明示する
- 過度に厳しくしない
- 柔軟性とのバランス

---

## 15. プリコンピュテーション (Precomputation) [P1]

**定義**: 先人が見つけた最適値を活用し、ユーザーの意思決定を簡略化する

### プリコンピュテーションの形態

1. **スマートデフォルト**: 過去の選択、地域・文化に応じた初期値
2. **テンプレート**: 文書、プレゼン、コード
3. **プリセット**: カメラ設定（ポートレート、風景）
4. **推奨設定**: デバイス性能に基づく最適化
5. **オートコンプリート**: 住所自動補完

### 実装ポイント

```javascript
// 地域に応じたデフォルト
const RegionalDefaults = {
  "ja-JP": {
    dateFormat: "YYYY/MM/DD",
    currency: "JPY",
    timezone: "Asia/Tokyo",
  },
  "en-US": {
    dateFormat: "MM/DD/YYYY",
    currency: "USD",
    timezone: "America/New_York",
  },
};

// 郵便番号から住所自動補完
async function autoFillAddress(postcode) {
  if (postcode.length === 7) {
    const address = await fetchAddressByPostcode(postcode);
    document.getElementById("prefecture").value = address.prefecture;
    document.getElementById("city").value = address.city;
  }
}
```

### 良い例

- 炊飯器の水位目盛り: 最適な水量を事前計算
- Word の文書テンプレート: プロが作成した最適レイアウト

### 悪い例

- すべてのフィールドが空欄
- 不適切なデフォルト（年齢: 1 歳、国: アフガニスタン）

---

## 16. フィッツの法則 (Fitts' Law) [P2]

**定義**: 近くて大きいものほど操作しやすく、遠くて小さいものほど操作しにくい

**数式**: `MT = a + b × log₂(D/W + 1)`（MT: 移動時間, D: 距離, W: ターゲット幅）

### 画面上の特別なエリア（操作しやすい順）

1. **現在のポインター位置**: コンテキストメニュー
2. **画面の四隅**: 無限大の幅（macOS ホットコーナー）
3. **画面の端**: 無限大の幅（タスクバー、メニューバー）
4. **大きな要素**: プライマリボタン
5. **小さな要素**: 最も困難

### フィッツ実装ポイント

```css
/* 重要度による階層 */
.btn-primary-large {
  padding: 20px 40px;
  min-height: 60px;
  min-width: 200px;
}
.btn-secondary {
  padding: 14px 28px;
  min-height: 48px;
}
.btn-tertiary {
  padding: 10px 20px;
  min-height: 36px;
}

/* 関連操作は近接配置 */
.tool-group {
  display: flex;
  gap: 2px;
}

/* モバイルのタッチターゲット */
.touch-target {
  min-width: 44px;
  min-height: 44px;
}
```

### チェック項目

- [ ] プライマリアクションは大きく配置したか？
- [ ] 関連する操作は近くに配置したか？
- [ ] 画面の端・隅を活用したか？
- [ ] タッチターゲットは最小 44×44px か？

---

## 17. ヒックの法則 (Hick's Law) [P2]

**定義**: 選択肢が増えると決定時間は対数的に増加する

**数式**: `RT = a + b × log₂(n)`（RT: 反応時間, n: 選択肢の数）

### 実践的な目安

- メニュー項目: 7±2 個
- 一画面の主要アクション: 1-3 個
- 選択肢が多い場合: カテゴリ化、検索機能

### 選択肢を減らす方法

1. **カテゴリ化**: グループ分けで段階的選択
2. **フィルタリング**: 絞り込み機能
3. **検索**: 直接入力で探す
4. **レコメンド**: よく使う項目を優先表示
5. **段階的開示**: 詳細はクリックで表示

### 実装例

```html
<!-- ❌ 悪い例: 30 個の選択肢が並ぶ -->
<select>
  <option>選択肢 1</option>
  <!-- ... 30 個 ... -->
</select>

<!-- ✅ 良い例: カテゴリ化 -->
<select id="category">
  <option>カテゴリ A</option>
  <option>カテゴリ B</option>
</select>
<select id="subcategory">
  <!-- カテゴリに応じた選択肢 -->
</select>
```

### ヒック法則の注意点

- 選択肢を減らしすぎると必要なオプションが見つからない
- 重要なのは「認知しやすさ」であり、物理的な数だけではない
- よく整理されたメニューなら多少多くても許容される
